### 安裝方法（**需要以管理員身份進行**）
* 訪問 http://www.winpcap.org/install/default.htm 下載並**以管理員許可權安裝** WinPcap
    * **Release 版本壓縮包中也提供有 WinPcap 的安裝程式**
    * WinPcap 只需要安裝一次，以後更新時請從第2步開始操作
    * 如果 WinPcap 提示已安裝舊版本無法繼續時，參見 `FAQ` 中 `運行結果分析` 一節
    * 安裝時自啟動選項對工具的運行沒有影響，因為本工具直接調用 WinPcap API，不需要經過伺服器程式
* 訪問 https://github.com/chengr28/Pcap_DNSProxy/tree/Release 並使用 GitHub 的 `Download ZIP` 功能將所有檔下載到本地
    * Windows 版本的 Pcap_DNSProxy 在 ZIP 的 Windows 目錄內，可將整個目錄單獨抽出運行
    * Windows 下批次處理會自動判斷 x64 和 x86 版本
* 打開下載回來的 ZIP 檔，將 Windows 目錄解壓到磁片的任意位置
    * 目錄所在位置和程式檔案名可以隨意更改
    * 注意：設定檔/Hosts檔和IPFilter檔只能使用固定的檔案名（更多詳細情況參見下文 `功能和技術` 一節）
* 確定工具目錄的名稱和路徑後進入目錄內，**右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行** `ServiceInstall.bat`
    * 批次處理會將程式註冊系統服務，並進行 Windows 防火牆測試
    * 以後每次開機服務都將自動啟動
* **此時Windows系統會詢問是否同意程式訪問網路，請將 「私人網路絡」 以及 「公用網路」 都勾上並確認**
    * 打開 `網路和共用中心` - `更改配接器設置` 選擇 `本地連接` 或 `寬頻連線`（取決於實際使用的網路介面卡）
    * 右擊 `屬性` - `Internet協定版本4(IPv4)` - 屬性 - 勾選 `使用下面的DNS伺服器位址`
    * **在 `首選DNS伺服器` 內填入 `127.0.0.1` 確定保存並退出即可**
    * 如果需要使用IPv6協定的本機伺服器
        * 請先編輯設定檔的 `IPv6 DNS Address` 一欄，參見下文 設定檔詳細參數說明 一節
        * 右擊 `屬性` - `Internet協定版本6(IPv6)` - `屬性` - 勾選 `使用下面的DNS伺服器位址`
        * 在 `首選DNS伺服器` 內填入 `::1` 確定保存並退出即可
    * 注意：建議將 `本地連接` 和 `無線連接` 以及 `寬頻連線` 全部修改！

### 重啟服務方法（**需要以管理員身份進行**）
* **右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行** `ServiceStop.bat`
    * 批次處理將直接停止服務的運行
* **右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行** `ServiceStart.bat` 即可
    * 批次處理將啟動服務，完成後相當於重啟服務

### 更新程式方法（**需要以管理員身份進行**）
**注意：更新程式切勿直接覆蓋，否則可能會造成不可預料的錯誤！**請按照以下的步驟進行：
* 提前下載好新版本的 Pcap_DNSProxy（亦即 `安裝方法` 中第2步），**更新過程可能會造成功能變數名稱解析短暫中斷**
* 備份好所有設定檔/Hosts檔/IPFilter檔的自訂內容
* **右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行** ServiceStop.bat 停止服務
* 將整個 Pcap_DNSProxy 程式的目錄刪除
    * 注意 Windows 防火牆可能會留有允許程式訪問網路的資訊，卸載服務後又變更了程式的目錄則可能需要使用註冊表清理工具清理
* 將新版本的 Pcap_DNSProxy 解壓到任何位置（亦即 `安裝方法` 中第3步）
* 將設定檔的自訂內容加回新版本設定檔裡相應的區域內
* 按照 `安裝方法` 中第4步重新部署 Pcap_DNSProxy

### 安全模式下的使用方法（**需要以管理員身份進行**）：
程式具備在安全模式下運行的能力，在安全模式下右鍵以管理員身份直接運行程式
* 直接運行模式有主控台視窗，關閉程式時直接關閉主控台視窗即可
* 注意：直接運行可能會生成 `Service start error, ERROR_FAILED_SERVICE_CONTROLLER_CONNECT(The service process could not connect to the service controller).` 錯誤，因為程式是設計運行于系統服務模式，雖然也可直接運行但並不推薦

### 卸載方法（需要以管理員身份進行）：
* 按照 `安裝方法` 中第6步還原DNS功能變數名稱伺服器位址配置
* **右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行** ServiceUninstall.bat 即可，批次處理將直接停止服務並卸載服務
    * 注意 Windows 防火牆可能會留有允許程式訪問網路的資訊，故卸載後可能需要使用註冊表清理工具清理
    * **轉移工具目錄路徑不需要卸載服務**，先停止服務轉移，轉移完成後重新右鍵以管理員身份(Vista以及更新版本)或直接以管理員登錄按兩下(XP/2003)運行 ServiceInstall.bat 即可

### 正常工作查看方法
* 打開命令提示符
    * 在開始功能表或直接 `Win + R` 調出 `運行` ，輸入 `cmd` 並回車
    * 開始功能表 - `程式/所有程式` - `附件` - `命令提示符`
* 輸入 `nslookup www.google.com` 並回車
* 運行結果應類似：

    >nslookup www.google.com<br />
    服务器:  pcap-dnsproxy.localhost.server（視設定檔設置的值而定，參見下文 `配置文件详细参数说明` 一節）
    Address:  127.0.0.1（視所在網路環境而定，原生IPv6為 ::1）<br />
<br />
    非权威应答:<br />
    &nbsp;&nbsp;&nbsp;&nbsp;名称:    www.google.com<br />
    &nbsp;&nbsp;&nbsp;&nbsp;Addresses: ……（IP位址或地址清單）

* 如非以上結果，請移步 [FAQ 文檔](https://github.com/chengr28/Pcap_DNSProxy/wiki/FAQ) 中 `運行結果分析` 一節

-----


